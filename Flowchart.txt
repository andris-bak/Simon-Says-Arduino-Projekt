
┌──────────────────────────┐
│           START          │
└─────────────┬────────────┘
              │
              ▼
┌──────────────────────────┐
│ Hardver inicializálása   │
│ - LED-ek OUTPUT          │
│ - Gombok INPUT_PULLUP    │
│ - Piezo OUTPUT           │
│ - LCD init               │
└─────────────┬────────────┘
              │
              ▼
┌──────────────────────────┐
│ Startup LED + hang demo  │
└─────────────┬────────────┘
              │
              ▼
┌──────────────────────────┐
│ EEPROM-ból high score    │
│ beolvasása               │
└─────────────┬────────────┘
              │
              ▼
┌──────────────────────────┐
│ "Press any button" LCD   │
│ és várakozás             │
└─────────────┬────────────┘
              │  (gomb?)
              │────────────► NEM → vissza
              ▼ IGEN
┌──────────────────────────┐
│ randomSeed("gomb idő")   │
└─────────────┬────────────┘
              │
              ▼
┌──────────────────────────┐
│ resetGame()              │
│ level=0, score=0         │
│ userIndex=0              │
│ newRound=true            │
└─────────────┬────────────┘
              │
              ▼
         ┌────────┐
         │  LOOP  │
         └───┬────┘
             │
             ▼
┌────────────────────────────┐
│     newRound == true ?     │
└─────────────┬──────────────┘
              │ IGEN
              ▼
┌────────────────────────────┐
│ Hozzáad 1 random számot    │
│ sequenceSteps[level]       │
│ level++                    │
└─────────────┬──────────────┘
              │
              ▼
┌────────────────────────────┐
│ showSequence(level)        │
│ (villogtatás + hang)       │
└─────────────┬──────────────┘
              │
              ▼
┌────────────────────────────┐
│ userIndex = 0              │
│ newRound = false           │
└─────────────┬──────────────┘
              │
              ▼
 (VISSZA A LOOP ELEJÉRE)
              │
              ▼
┌────────────────────────────┐
│ pressed = readButton()     │
│ (0..3 vagy -1)             │
└─────────────┬──────────────┘
              │
     ┌────────┴────────┐
     │                 │
     ▼                 ▼
 -1 (nincs gomb)   IGEN: gomb megnyomva
     │                 │
     ◄────── vissza ───┘
                       │
                       ▼
┌────────────────────────────────┐
│ flashLed(pressed)              │
└────────────────┬───────────────┘
                 │
                 ▼
┌──────────────────────────────────────┐
│ pressed == sequenceSteps[userIndex]? │
└───────────────┬──────────────────────┘
                │
         ┌──────┴───────┐
         │              │
         ▼              ▼
      IGEN             NEM
         │              │
         ▼              ▼
┌───────────────────┐   ┌────────────────────────────┐
│ userIndex++       │   │ gameOver() animáció        │
│ score++           │   │ LCD: score + highscore     │
│ highscore update  │   │ delay(2500)                │
└───────────┬───────┘   └────────────────────────────┘
            │                       │
            ▼                       ▼
┌────────────────────────────┐   ┌────────────────────┐
│ userIndex == level ?       │   │ resetGame()        │
└───────────────┬────────────┘   └─────┬──────────────┘
                │ IGEN                 │
                ▼                      │
┌────────────────────────────┐         │
│ victoryFlash()             │         │
│ delay(400)                 │         │
│ newRound = true            │◄────────┘
└───────────────┬────────────┘
                │
      (vissza LOOP elejére)

